---
layout: post
author: teteteo619
title: preloadã¨eager_loadã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦
date: 2023-05-07
thumbnail: /assets/img/posts/hello.jpg
category: Ruby on Rails
summary: Ruby on Railsã«ãŠã„ã¦ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹éš›ã«preloadã¨eager_loadã®ä½¿ã„åˆ†ã‘ã‚’ã—ã£ã‹ã‚Šã¨ç†è§£ã™ã‚‹
keywords: Rails
permalink: /blog/
---
# ğŸšª preloadã¨eager_loadã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦
## âœ… å‰ææ¡ä»¶:å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ãªå ´åˆ
- æ¡ä»¶ã‚’æŒ‡å®šã™ã‚‹(whereãªã©ã‚’ä½¿ã†)ã‚ˆã†ãªå ´åˆã¯ã€eager_loadã‚’ä½¿ã†ã€‚(ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆã—ã¦ã„ãªã‘ã‚Œã°ã€ãã‚‚ãã‚‚é–¢é€£å…ˆã®æƒ…å ±ãŒã‚ã‹ã‚‰ãªã„ãŸã‚preloadã¯ä½¿ãˆãªã„)
æ¡ä»¶ã‚’æŒ‡å®šã—ãªã„å ´åˆã¯ã€preloadã€each_loadã®ä½¿ã„åˆ†ã‘ã¯ã‚±ãƒ¼ã‚¹ãƒã‚¤ã‚±ãƒ¼ã‚¹ã€‚æ‰€å¾—ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã®ã‚«ãƒ©ãƒ ãŒå°‘ãªã„ãªã‚‰
- each_loadã‚’ä½¿ã£ã¦ä¸€ã¤ã®ã‚¯ã‚¨ãƒªã§æ¸ˆã¾ã›ã‚‹ã¹ãã ã—ã€å¤šã„ãªã‚‰preloadä½¿ã£ãŸæ–¹ãŒã„ã„ã‹ã‚‚ã€‚åŸºæœ¬çš„ã«ã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã¯preloadä½¿ã£ãŸæ–¹ãŒæ—©ã„ã€‚
ã•ã‚‰ã«ã“ã®è¨˜äº‹ã®æ–¹ã®è€ƒãˆæ–¹ã‚’å‰ææ¡ä»¶ã«è¿½åŠ ã—ã¦ã„ã£ã¦è€ƒãˆã¦ã„ãã¾ã™ã­ã€‚

## âœ… å‰ææ¡ä»¶:å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹+é–¢é€£å…ˆã®ãƒ‡ãƒ¼ã‚¿ãŒ1å¯¾1ã§ã‚ã‚‹ã‚ˆã†ãªå ´åˆ
- 1å¯¾1ã§ã‚ã‚‹ã‹ã¤æ¡ä»¶ã‚’æŒ‡å®šã—ãªã„å ´åˆã€eager_loadã‚’ä½¿ã†ã“ã¨ã§çµåˆã—ã¦ã‹ã‚‰ã¾ã¨ã‚ã¦å–å¾—ã™ã‚‹æ–¹ãŒåŠ¹ç‡ãŒè‰¯ã„å ´åˆãŒå¤šã„ã€‚ (1å¯¾1ã«ãªã‚‹ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ãã‚‹å ´åˆã¯ã€æŠ½è±¡çš„ã§ã™ãŒé–¢é€£åº¦ãŒã‹ãªã‚Šå¼·ã„ã®ã§çµåˆã—ã¦ã„ã£ãŸæ–¹ãŒåŠ¹ç‡ãŒå¤šã„å ´åˆãŒå¤šã„ã¨ã„ã†è§£é‡ˆã€‚company_userã¨company_user_profileçš„ãªï¼)
- 1å¯¾1ã§ã‚ã‚‹ã‹ã¤æ¡ä»¶ã‚’æŒ‡å®šã™ã‚‹(whereãªã©ã‚’ä½¿ã†)ã‚ˆã†ãªå ´åˆã¯å½“ç„¶eager_loadãŒå½“ã¦ã¯ã¾ã‚‹ã€‚
## âœ… å‰ææ¡ä»¶:å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹+é–¢é€£å…ˆã®ãƒ‡ãƒ¼ã‚¿ãŒ1å¯¾å¤šã§ã‚ã‚‹ã‚ˆã†ãªå ´åˆ
- 1å¯¾å¤šã§ã‚ã‚‹ã‹ã¤æ¡ä»¶ã‚’æŒ‡å®šã—ãªã„å ´åˆã€includesã®æŒ™å‹•é€šã‚Špreloadã‚’ä½¿ã†
- 1å¯¾å¤šã§ã‚ã‚‹ã‹ã¤æ¡ä»¶ã‚’æŒ‡å®šã™ã‚‹(whereãªã©ã‚’ä½¿ã†)ã‚ˆã†ãªå ´åˆã€çµåˆã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã®ã§eager_loadã‚’ä½¿ã†ã—ã‹ãªã„
# ğŸšª æ³¨æ„ç‚¹
- ã“ã“ã¾ã§ã®è€ƒãˆã§ã‚ã£ã¦ã„ã‚‹ã®ãªã‚‰ã€ä¸€å¯¾ä¸€ã®ã¨ãã¯eager_loadã‚’ä½¿ã†å ´åˆãŒè‰¯ã„ã®ã‹ã‚‚ã—ã‚Œãªã„ãŒçµåˆã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒé‡è¤‡ã™ã‚‹ã‚ˆã†ãªå ´åˆãŒã‚ã‚‹ã€‚ãã®æ™‚ã¯ã€preloadã‚’ä½¿ã†ã®ã‚‚æ¤œè¨ã€‚ãªãœãªã‚‰ã€eager_loadã«ã¯distinctãŒå‚™ã‚ã£ã¦ã„ãªã„ãŸã‚ã«æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿æ•°ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€‚(ã‚“ãƒ¼ã§ã‚‚ãã®å‰ã«distinctãƒ¡ã‚½ãƒƒãƒ‰ä½¿ãˆã°ã„ã„ã®ã§ã¯ãªã„ã‹ï¼Ÿ)
- preloadã‚’ä½¿ã†æ™‚ã«ã€æœ€åˆã®ã‚¯ã‚¨ãƒªã®ãƒ‡ãƒ¼ã‚¿å–å¾—é‡ãŒå¤šã™ãã‚‹ã¨inå¥å†…ã®è†¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦SQLè‡ªä½“ã®è¨­å®šå€¤ã‚„ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºã®è¨­å®šå€¤ã‚’è€ƒæ…®ã—ãªã‘ã‚Œã°ã„ã‘ãªã„
- includesã¯eager_loadã¨preloadã‚’åˆ¤æ–­ã™ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã€ã¾ãŸçŠ¶æ³ã‚’è€ƒãˆãŸã‚¯ã‚¨ãƒªã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—æ“ä½œãŒæ‚ªã„ã®ã§ã‚ã¾ã‚Šä½¿ã†ã¹ãã§ãªã„ã€‚

å‚è€ƒæ–‡çŒ®

> - [ActiveRecordã®includes, preload, eager_load ã®å€‹äººçš„ãªä½¿ã„åˆ†ã‘](https://moneyforward-dev.jp/entry/2019/04/02/activerecord-includes-preload-eagerload/)
> - [Rails: JOINã™ã¹ãã‹ã©ã†ã‹ã€ãã‚ŒãŒå•é¡Œã  â€” #includesã®æŒ¯èˆã„ã‚’ç†è§£ã™ã‚‹ï¼ˆç¿»è¨³ï¼‰](https://techracho.bpsinc.jp/hachi8833/2021_09_22/45650)
> - [ãªãœã€SQLã¯é‡ãŸããªã‚‹ã®ã‹ï¼Ÿâ”€â”€ã€SQLãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©³è§£ã€ã®ç¿»è¨³è€…ãŒæ•™ãˆã‚‹åŸå› ã¨å¯¾ç­–](https://eh-career.com/engineerhub/entry/2017/06/26/110000#%E5%8E%9F%E5%9B%A0ORM%E3%81%8C%E7%94%9F%E6%88%90%E3%81%99%E3%82%8BSQL%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84)
